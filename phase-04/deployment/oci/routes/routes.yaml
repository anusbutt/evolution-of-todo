# [Task]: T030 | [Spec]: specs/005-phase-05-cloud-native/spec.md
# OpenShift Routes for external access to services
# Usage: oc apply -f routes.yaml
# Routes auto-generate hostnames like: <service>-<project>.apps.sandbox.xxx.openshiftapps.com

---
# Frontend Route (Main application entry point)
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: frontend
  labels:
    app: todo-app
    component: frontend
  annotations:
    # Allow larger request bodies for file uploads if needed
    haproxy.router.openshift.io/timeout: 60s
spec:
  # Host is auto-generated if left empty
  # host: frontend-<project>.apps.sandbox.xxx.openshiftapps.com
  port:
    targetPort: 3000
  to:
    kind: Service
    name: frontend
    weight: 100
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  wildcardPolicy: None

---
# Backend Route (API access)
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: backend
  labels:
    app: todo-app
    component: backend
  annotations:
    haproxy.router.openshift.io/timeout: 120s
spec:
  # Host is auto-generated if left empty
  # host: backend-<project>.apps.sandbox.xxx.openshiftapps.com
  port:
    targetPort: 8000
  to:
    kind: Service
    name: backend
    weight: 100
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  wildcardPolicy: None

---
# MCP Server Route (AI chatbot API)
apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: mcp-server
  labels:
    app: todo-app
    component: mcp-server
  annotations:
    haproxy.router.openshift.io/timeout: 180s  # Longer timeout for AI operations
spec:
  # Host is auto-generated if left empty
  # host: mcp-server-<project>.apps.sandbox.xxx.openshiftapps.com
  port:
    targetPort: 5001
  to:
    kind: Service
    name: mcp-server
    weight: 100
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  wildcardPolicy: None
